---
title: "rSurveyAssign: tools for simulation of assignment in web surveys"
author: "Shigeru ONO"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{rSurveyAssign: tools for simulation of assignment in web surveys}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

`rSurveyAssign`パッケージは、web調査における対象者割付についてのシミュレーションを行うためのパッケージです。

このパッケージを使うと、ある種の対象者割付を行うweb調査について、必要な標本サイズを見積もったり、割付によって生じるバイアスを評価したりすることができます。また、すでに行った調査について調査ウェイトを求めることもできます。

ここでは、`rSurveyAssign`パッケージの背後にある考え方と、パッケージの用途について説明します。

## 1. 事例: 製品ブランドのイメージ測定

このパッケージについて説明するための例として、
ある製品カテゴリの$K$個の製品ブランドについて、消費者が抱いているイメージを測定したい、
という場面について考えます。

### 1.1 4つの調査手続き
この調査の手続きについて考えてみましょう。まず、次の手続きが考えられます。

- **調査手続きA. すべてのブランドに割り付ける**
  - 対象者にあるひとつのブランドを提示し、そのブランドのイメージについての設問に対する回答を求めます。
    これを、$K$個すべてのブランドについて繰り返します。
    
この手続きでは、対象者は同一の設問に対する回答を$K$回繰り返す事になります。
ブランドの数が多いときは、回答者への負荷が高くなってしまいます。そこで、次の手続きを考えます。

- **調査手続きB. J個のブランドに割り付ける**
  - 調査者は、それぞれの対象者について、その人に提示するブランドを$J$個選びます。$J$はブランド数$K$よりも小さく、
    十分に小さな値とします。以下ではこれを「対象者を$J$個のブランドに**割り付ける**」と表現します。
  - 対象者に、割り付けられた$J$個のブランドのうちひとつを提示し、イメージについての設問に対する回答を求めます。
    これを、$J$個のブランドについて繰り返します。

この手続きでは、ブランドの数がいくつあっても、対象者は設問への回答を$J$回繰り返せば良いことになります。

上記2つの手続きでは、いずれの対象者もいずれのブランドに対して割付可能であると仮定してきました。
しかし実際には、対象者はすべてのブランドについて知っているわけではないかもしれません。
対象者が知らないブランドについてイメージを訊ねても、有益な回答は得られないでしょう。
そこで、次のような手続きを考えます。

- **調査手続きC. 知っているすべてのブランドに割り付ける**
  - それぞれの対象者に、$K$個のブランドのリストを提示し、知っているブランドはどれか訊ねます。
  - それぞれの対象者を、その人が知っているすべてのブランドに**割り付け**ます。
    いずれのブランドについても知らないと答えた人に対しては、調査を中止します。
  - 対象者に、割り付けられたブランドのうちひとつを提示し、イメージについての設問を提示し、
    回答を求めます。これを、その人が割り付けられたすべてのブランド(=その人が知っているすべてのブランド)について繰り返します。

この手続きでは、対象者にその人が知らないブランドについて回答してもらうという事態を避けることが
できます。しかし、たくさんのブランドを知っている人は、調査手続きA.と同じく、
同一の設問に対する回答を何度も繰り返すことになります。
回答者への負荷は回答者によってばらつき、多くのブランドを知っている人ほど負荷が高くなってしまいます。

そこで、次のような手続きを考えます。

- **調査手続きD. 知っているブランドのうち1個～J個に割り付ける**
  - それぞれの対象者に、$K$個のブランドのリストを提示し、知っているブランドはどれかを訊ねます。
  - それぞれの対象者を、その人が知っているブランドのうち$1$個～$J$個のブランドに**割り付け**ます。
    いずれのブランドについても知らないと答えた人に対しては、調査を中止します。
  - 割り付けられた$J$個のブランドのうちひとつを提示し、
    イメージについての設問群を提示し、回答を求めまず。これを、$J$個のブランドについて繰り返します。

この手続きでは、対象者にその人が知らないブランドについて回答してもらうという事態を避けることが
できますし、ブランドをいくつ知っていても、対象者は設問への回答を多くても$J$回まで繰り返せば良いことになります。

4つの調査手続きについて整理しておきましょう。

-- ------------------------ ------------------------
   割付可能ブランド         割付ブランド
A. すべてのブランド         すべてのブランド
B. すべてのブランド         $1$～$J$個のブランド
C. 知っているブランド       すべてのブランド
D. 知っているブランド       $1$～$J$個のブランド
-- ------------------------ ------------------------

調査手続きC.やD.のように、対象者の回答(各ブランドを知っているかどうか)に応じてその後の設問を変更する手続きは、古典的な質問紙調査では困難でした。web調査ならではの調査手続きといえるでしょう。



### 1.2 調査手続きの性質


調査手続きD.は、いっけん良い手続きのようにみえます。しかしこの手続きは、次の2つの深刻な問題点を持っています。

- 必要な対象者数がわからない
- 回答の集計値がバイアスを持つ

#### 問題点1. 必要な対象者数がわからない

それぞれのブランドのイメージを測定するために、それぞれのブランドについて十分な件数の回答を得たいとしましょう。

- 調査手続きA.では、$N$人の対象者に調査すれば、各ブランドについて$N$件の回答が得られます。
- 調査手続きB.では、$N$人の対象者に調査すれば、全ブランドを通じて延べ $N \times J$ 件の回答が得られます。ブランドへの割付をバランス良く行えば、各ブランドについて $(N \times J) / K$ 件の回答が得られるはずです。
- 調査手続きC.では、対象者があるブランドについて知っている割合を$P$としたとき、そのブランドについて $N \times P$ 件の回答が得られます。事前に別の情報源から $P$ を推測できれば、十分な件数の回答を得るために必要な対象者数を逆算することができるでしょう。
- しかし調査手続きD.では、各ブランドについて何件の回答が得られるかを事前に推測することが困難です。

#### 問題点2. 回答の集計値がバイアスを持つ

調査手続きD.によって得た回答の集計値がどのような性質を持つか、簡単な例を通じて考えてみましょう。

調査対象のブランドを{a,b,c}の3つとし、割付ブランド数の上限$J$を2とします。対象者を割り付けるブランドは、その対象者が知っているブランドのなかから等確率で選ぶと仮定します。aについて知っている対象者は、下表の4種類に分かれます。

aについて  bについて   cについて   aに割り付けられる確率 
---------- ----------- ----------- ----------------------
知っている 知らない    知らない    $1$
知っている 知っている  知らない    $1$
知っている 知らない    知っている  $1$
知っている 知っている  知っている  $2/3$

bとcのどちらも知らない、ないしどちらか一方しか知らない人は、必ずaに割り付けられます。
いっぽう、a,b,cのすべてを知っている人がaに割り付けられる確率は$2/3$です。

このように、この調査手続きで集めたaについての回答は、aについて知っている人々のうち、他のブランドを知らない人々の回答へと偏ることになります。この偏りを**割付バイアス**と呼ぶことにします。

割付バイアスの大きさは、各ブランドが知られている程度や、割り付けるブランドの選び方によって複雑に変化します。そのため、推測するのは容易ではありません。
  
### 1.3 このパッケージの目的

調査対象者に刺激を提示し反応を測定したい一方、個々の対象者に提示できる刺激に制約があるという場面は、調査実務において珍しくありません。回答負荷や調査コストの削減のため、調査手続きD.のように割付の最適化を図る場合も多いでしょう。その反面、このような割付の最適化を行うと、事前の標本サイズ設計は困難になり、また調査結果は割付バイアスを持ちます。

`rSurveyAssign`パッケージはこの問題に対処するためのパッケージです。このパッケージは、上記の調査手続きDのような割付最適化を伴う調査に対して、3つの機能を提供します。

- 必要な対象者数を事前に推測する
- 集計値における割付バイアスを事前に評価する
- 集計値から割付バイアスを取り除くためのウェイトを算出する

## 2. このパッケージが想定している状況

### 2.1 カテゴリ・スロット・割付可能性

このパッケージは、次の状況を想定して作られています。

- 1つ以上の「**カテゴリ**」がある。
- あるカテゴリは、1つ以上の「**スロット**」からなるリストを持つ。
- すべてのカテゴリのすべてのスロットについて調査したい。
- それぞれの調査対象者は、それぞれのカテゴリについて「**割付可能**」かそうでないかのいずれかである。
- それぞれの調査対象者は、それぞれのスロットについて「**割付可能**」かそうでないかのいずれかである。
- ある対象者を割り付けることができるカテゴリ・スロットの数には上限がある。

たとえば、次のような状況がそうです。

- いくつかの製品カテゴリがある。
- 各製品カテゴリには、いくつかのブランドが含まれている。
- すべての製品カテゴリのすべてのブランドについて、消費者が抱いているイメージを調べたい。
- ある対象者にあるカテゴリについて詳しく訊くためには、その対象者はそのカテゴリの
使用者でなければならない。
- ある対象者にあるブランドについて詳しく訊くためには、
その対象者はそのブランドについて知っていなければならない。
- ある対象者に詳しく訊くことができるカテゴリとブランドの数には上限がある。

この例では、「カテゴリ」は製品カテゴリ、「スロット」はブランドに対応しています。
下の表を参照してください。

このパッケージでの用語 例
---------------------- -----------------------
カテゴリ               製品カテゴリ
カテゴリへの割付可能性 その製品カテゴリを使用しているか
割付カテゴリ数の上限   ある人に最大で何カテゴリまで詳しく訊けるか
スロット               ブランド
スロットへの割付可能性 そのブランドを知っているか
割付スロット数の上限   ある人に最大で何ブランドまで詳しく訊けるか
---------------------- -----------------------

これは一例にすぎません。このパッケージは、「カテゴリ」「スロット」「割付可能」が
具体的に何を指すのかは問いません。また、割り付けたスロットについてなにを聴取するのかも問いません。

### 2.2 調査手続き

このパッケージでは、Web調査を想定し、次のように仮定します。

- 調査対象者の調査への参加は逐次的に行われると仮定します。すなわち、全員が同時に回答をはじめるのではなく、まちまちのタイミングで回答をはじめると仮定します。また、ある対象者のカテゴリ・スロットへの割付も逐次的に行われるものとします。
- それぞれのスロットについて、そのスロットに割り付けたい対象者数が定められているとします。これを「**目標対象者数**」と呼びます。
- 調査実施中のある時点において、それまでに割り付けられた対象者数が目標対象者数に達していないスロットを「**オープン**」、達しているスロットを「**クローズド**」と形容することにします。
- 調査実施中のある時点において、オープンなスロットが1つ以上あるカテゴリを「**オープン**」、すべてのスロットがクローズドであるカテゴリを「**クローズド**」と形容することにします。

本パッケージは以下に説明する調査手続きを想定します。

- **Step 1.**:
  - ある人が調査に参加したとき、その人について、各カテゴリについて割付可能であるかどうかを調べる。
- **Step 2.**
  - なんらかの方法で、その対象者のすべての割付可能カテゴリのうちいくつかを選ぶ。
  - これを、「対象者を**カテゴリに割り付ける**」と呼び、
    選択されたカテゴリを「**割付カテゴリ**」と呼ぶ。
  - もし割付できなかったら、その対象者に対する調査は中止する。
- **Step 3.**
  - 対象者に、それぞれの割付カテゴリについてスロットのリストを提示し、それぞれについて割付可能かどうかを調べる。
- **Step 4.**
  - なんらかの方法で、その対象者のいずれかの割付カテゴリの割付可能スロットのなかからいくつかを選ぶ。
  - これを、「対象者を**スロットに割り付ける**」と表現し、選択されたカテゴリを「**割付スロット**」と呼ぶ。
  - もし割付できなかったら、その対象者に対する調査は中止する。
- **Step 5.**
  - 割付スロットについての詳細な設問を提示し、回答を得る。
- **Step 6.**
  - すべてのカテゴリがクローズドになったら、調査を終了する。

この調査手続きにおいては、Step 2.でのカテゴリの割付方法と、Step 4.でのスロットの割付方法に応じて、
必要な対象者数が大きく変わり、また割付バイアスの大きさも変わります。このパッケージでは、
さまざまな割付方法について検討することができます。このパッケージがカバーしている
割付方法について、["How to assign subjects"](vignette_assign.html)を参照して下さい。

## 3. このパッケージの用途

このパッケージは、上記の手続きによる調査を実施しようと考えている調査者、ないしすでに実施した調査者のためのパッケージです。

このパッケージの用途は次の3つです。

- **標本サイズ推定**: 
  - 上記の手続きによる調査を**計画しているとき**、
    各スロットについて必要な回答件数を得るためにはどの程度の調査対象者数が必要か、
    シミュレーションによって推定する。
  - 使用方法は["How to forecast sample size"](vignette_size.html)を参照して下さい。
- **バイアス評価**: 
  - 上記の手続きによる調査を**計画しているとき**、
    調査結果が持つであろうバイアスをシミュレーションによって評価する。
  - 使用方法は["How to estimate bias"](vignette_bias.html)を参照して下さい。
- **ウェイト算出**: 
  - 上記の手続きによる調査を**行ったあとで**、
    集計のためのウェイトをシミュレーションによって算出する。
  - 使用方法は["How to compute survey weights"](vignette_weight.html)を参照して下さい。

なお、このパッケージはweb調査の機能を提供するものではありません。web調査の実施時に対象者をカテゴリ・スロットへと割り付ける機能は、web調査システム上で別途実装する必要があります。
