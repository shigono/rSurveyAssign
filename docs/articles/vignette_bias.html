<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rSurveyAssign">
<title>How to estimate bias • rSurveyAssign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to estimate bias">
<meta property="og:description" content="rSurveyAssign">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rSurveyAssign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">rSurveyAssign: tools for simulation of assignment in web surveys</a>
    <a class="dropdown-item" href="../articles/vignette_assign.html">How to assign subjects</a>
    <a class="dropdown-item" href="../articles/vignette_bias.html">How to estimate bias</a>
    <a class="dropdown-item" href="../articles/vignette_size.html">How to forecast sample size</a>
    <a class="dropdown-item" href="../articles/vignette_weight.html">How to compute survey weights</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to estimate bias</h1>
                        <h4 data-toc-skip class="author">Shigeru
ONO</h4>
            
            <h4 data-toc-skip class="date">2024-03-21</h4>
      
      
      <div class="d-none name"><code>vignette_bias.Rmd</code></div>
    </div>

    
    
<p>ここでは、<code>rSurveyAssign</code>パッケージを使ったバイアス評価について
説明します。</p>
<p><code>rSurveyAssign</code>パッケージの背後にある考え方については、 <a href="vignette.html">“rSurveyAssign: tools for simulation of assignment
in web surveys”</a>を参照して下さい。</p>
<div class="section level2">
<h2 id="データの準備">1. データの準備<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99"></a>
</h2>
<p>母集団を表現するデータを用意し、popdataクラスのオブジェクトに変換します。
<a href="vignette_size.html">“How to forecast sample
size”</a>を参照して下さい。</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shigono.github.io/rSurveyAssign/">rSurveyAssign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 母集団オブジェクトの作成</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">popdata</span>, package <span class="op">=</span> <span class="st">"rSurveyAssign"</span><span class="op">)</span></span>
<span><span class="va">mbCat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bCat_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lSlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_1_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_2_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_3_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">lPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makePop.html">makePop</a></span><span class="op">(</span>mbCAT <span class="op">=</span> <span class="va">mbCat</span>, lSLOT <span class="op">=</span> <span class="va">lSlot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [makePop] # of categories: 3 </span></span>
<span><span class="co">#&gt; [makePop] # of slots: 10,10,10 </span></span>
<span><span class="co">#&gt; [makePop] # of members: 10000 </span></span>
<span><span class="co">#&gt; [makePop] # of member-category pairs which are assignable: 26488 (8829.3/category) </span></span>
<span><span class="co">#&gt; [makePop] # of member-slot pairs which are assignable: 58836 (1961.2/slot)</span></span></code></pre></div>
<p>割付のセッティングを指定します。 <a href="vignette_assign.html">“How
to assign subjects”</a>を参照して下さい。</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 割付のセッティング</span></span>
<span><span class="va">lSetting1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeSetting.html">makeSetting</a></span><span class="op">(</span></span>
<span>  lSLOT_REQUEST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lSlot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  nCAT_MAX      <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  sCAT_TYPE     <span class="op">=</span> <span class="st">'adaptive'</span>, </span>
<span>  sCAT_FILTER   <span class="op">=</span> <span class="st">'open'</span>, </span>
<span>  sCAT_ORDER    <span class="op">=</span> <span class="st">'shortnum'</span>, </span>
<span>  sCAT_EXCLUDE  <span class="op">=</span> <span class="st">'allclosed'</span>,</span>
<span>  nSLOT_MAX     <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  sSLOT_TYPE    <span class="op">=</span> <span class="st">'adaptive'</span>, </span>
<span>  sSLOT_FILTER  <span class="op">=</span> <span class="st">'open'</span>, </span>
<span>  sSLOT_ORDER   <span class="op">=</span> <span class="st">'shortnum'</span>, </span>
<span>  sSLOT_EXCLUDE <span class="op">=</span> <span class="st">'allclosed'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="シミュレーション">2. シミュレーション<a class="anchor" aria-label="anchor" href="#%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"></a>
</h2>
<p>割付によるバイアスを評価するためのシミュレーションを行ってみましょう。</p>
<p>このシミュレーションでは、次の試行を行います。</p>
<ul>
<li>母集団データから対象者を抽出し、カテゴリ・スロットへの割付を行う(<strong>割付試行</strong>)。</li>
<li>ある割付試行で得た調査データから、仮想的な調査データを再生成し、カテゴリ・スロットへの割付をやりなおす(<strong>再割付試行</strong>)。これを繰り返して、その割付試行において、ある対象者があるカテゴリないしスロットに割り付けられる確率を推定する。</li>
<li>あるカテゴリないしスロットに割り付けられた対象者間での、割付確率のばらつきを調べる。</li>
<li>以上の割付試行を複数回繰り返す。</li>
</ul>
<div class="section level3">
<h3 id="試行の実行">2.1 1試行の実行<a class="anchor" aria-label="anchor" href="#%E8%A9%A6%E8%A1%8C%E3%81%AE%E5%AE%9F%E8%A1%8C"></a>
</h3>
<p>まず、割付試行を1回だけ行ってみましょう。時間を節約するため、再割付試行は10回とします。</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="va">lResult1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simBias.html">simBias</a></span> <span class="op">(</span></span>
<span>  lPOP        <span class="op">=</span> <span class="va">lPop</span>, </span>
<span>  lSETTING    <span class="op">=</span> <span class="va">lSetting1</span>, </span>
<span>  nNUMRETRIAL <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sVERBOSE    <span class="op">=</span> <span class="st">"simple"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [simBias] nTrial: 1 ; extract: 5843 ; 2.41 sec.</span></span></code></pre></div>
<p>シミュレーションの結果をみてみましょう。</p>
<p><code>simBias</code>の返し値は3つの要素からなるリストです。
要素<code>dfSubject</code>は割付試行の結果を表しています(再割付試行ではありません)。</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lResult1</span><span class="op">$</span><span class="va">dfSubject</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   sRowname nPerson nCat1  nCat nSlot1 nSlot2 nTrial nSubject</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           <span style="text-decoration: underline;">6</span>779     1     1      9      6      1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2           <span style="text-decoration: underline;">5</span>953     2    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3           <span style="text-decoration: underline;">3</span>232     3    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4           <span style="text-decoration: underline;">1</span>226     2     2      7      5      1        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5           <span style="text-decoration: underline;">5</span>372     1     1      7     10      1        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6           <span style="text-decoration: underline;">7</span>652     2     2      2      1      1        6</span></span></code></pre></div>
<p>この割付試行では、対象者1として母集団メンバー6779が抽出され、カテゴリ1,2に割り付けられ、カテゴリ1のスロット9,6に割り付けられました。</p>
<p>要素<code>dfStat_Cat</code>は、再割付試行の結果のうち、
カテゴリへの再割付の結果を表しています。</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lResult1</span><span class="op">$</span><span class="va">dfStat_Cat</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   nSubject  nCat nCount_SubjectCat nCount_Subject nBlock nBlockSize nTrial</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1     1                 4              6      1         10      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2     2                 3             16      1         10      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        3     3                 2              9      1         10      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        4     2                 5              9      1         10      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        5     1                 8              8      1         10      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        6     2                 2             13      1         10      1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: sRowname &lt;chr&gt;, nPerson &lt;int&gt;</span></span></span></code></pre></div>
<p>10回の再割付試行を通じて、対象者1(正確には、対象者1に相当する割付可能性を持っている人)は延べ6回抽出されました。そのうちカテゴリ1への割付が生じたのは4回でした。つまり、この割付試行における対象者1のカテゴリ1への割付確率はおよそ4/6=0.67であったと推定されます。</p>
<p>要素<code>dfStat_Slot</code>は、再割付試行の結果のうち、スロットへの再割付の結果を表しています。</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lResult1</span><span class="op">$</span><span class="va">dfStat_Slot</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">#&gt;   nSubject  nCat nSlot nCount_SubjectSlot nCount_Subject nBlock nBlockSize</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1     1     9                  0              6      1         10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        1     1     6                  0              6      1         10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        4     2     7                  5              9      1         10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        4     2     5                  1              9      1         10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        5     1     7                  3              8      1         10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        5     1    10                  2              8      1         10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: nTrial &lt;int&gt;, sRowname &lt;chr&gt;, nPerson &lt;int&gt;</span></span></span></code></pre></div>
<p>10回の再割付試行を通じて、対象者1(正確には、対象者1に相当する割付可能性を持っている人)は延べ6回抽出され、そのうちカテゴリ1のスロット9への割付が生じたのは9回でした。割付確率はおよそ0/6
=
0.00であったと推定されます。実際には割付確率は0ではないので(もしそうであれば割付試行において割付が起きなかったはずです)、0に近い値、ということを意味しています。</p>
</div>
<div class="section level3">
<h3 id="多数の試行の実行と保存">2.2 多数の試行の実行と保存<a class="anchor" aria-label="anchor" href="#%E5%A4%9A%E6%95%B0%E3%81%AE%E8%A9%A6%E8%A1%8C%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%A8%E4%BF%9D%E5%AD%98"></a>
</h3>
<p>上の例では、割付試行を1回、再割付試行を10回行い、
シミュレーションの結果をデータフレームのリストとして取得しました。</p>
<p>バイアスを評価するためには、十分な数の再割付試行を繰り返す必要があります。
そこで今度は、割付試行を10試行、再割付試行を割付試行あたり1000試行繰り返してみましょう。</p>
<p>シミュレーションの結果はサイズが大きいので、SQLiteデータベース上に
保存したほうがよいでしょう。
以下の例では、SQLiteデータベースファイルとして<code>..\tools\rSurveyAssign_vignette_bias_1.sqlite</code>を
作成しています。実際には、適切なフォルダとファイル名を指定してください。また、
データベースファイルは、必要がなくなったら自分で消してください。</p>
<p>実行時間を短くするため、並列処理を行うことにします。引数<code>bPARALLEL</code>にTRUEを指定します。
並列処理を行う場合、各試行についてのメッセージは画面に表示されません。
そこでログファイルを作成することにします。
実行に長い時間がかかる場合は、ログファイルを監視すると、
いま何試行まで進んでいるかわかり、少しだけ心が癒されるでしょう。</p>
<p>下の例では、ログファイルを<code>C:/work/simWeight.log</code>としています。
RStudioを使っているなら、Terminalウィンドウで<code>tail -F C:/work/simWeight.log</code>を
実行すると、ログファイルを監視できます。</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 都合によりコメントアウトしています</span></span>
<span><span class="co"># set.seed(123)  # 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="co"># simBias (</span></span>
<span><span class="co">#   lPOP        = lPop, </span></span>
<span><span class="co">#   lSETTING    = lSetting1, </span></span>
<span><span class="co">#   sDBPATH     = "..\tools\rSurveyAssign_vignette_bias_1.sqlite",</span></span>
<span><span class="co">#   nNUMTRIAL   = 10,</span></span>
<span><span class="co">#   nNUMRETRIAL = 1000,</span></span>
<span><span class="co">#   bAPPEND     = FALSE, </span></span>
<span><span class="co">#   bPARALLEL   = TRUE,</span></span>
<span><span class="co">#   sLOGFILE    = "c:/work/simWeight.log"</span></span>
<span><span class="co"># )</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="バイアスを評価するための指標">3. バイアスを評価するための指標<a class="anchor" aria-label="anchor" href="#%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E6%8C%87%E6%A8%99"></a>
</h2>
<p>十分な回数の再割付試行を行ったとしましょう。ここから調査結果が持つバイアスを評価するためにはどのようにしたらよいでしょうか。</p>
<p><code>rSurveyAssign</code>パッケージは、調査結果が持つバイアスを評価するために、次の3つの指標を提供しています。</p>
<ul>
<li><strong>割付確率の変動係数</strong></li>
<li><strong>デザイン効果 </strong></li>
<li><strong>実質標本サイズ </strong></li>
</ul>
<div class="section level3">
<h3 id="割付確率の変動係数">3.1 割付確率の変動係数<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E7%A2%BA%E7%8E%87%E3%81%AE%E5%A4%89%E5%8B%95%E4%BF%82%E6%95%B0"></a>
</h3>
<p>以下では、調査で測定したい変数のことを調査変数と呼ぶことにします。
調査の目的は、各カテゴリ・スロットにおける調査変数の母集団特性(たとえば母平均)を推定することです。
バイアスとは、調査変数の母集団特性と、調査に基づくその推定値との差の期待値のことです。</p>
<p>あるカテゴリ・スロットについての回答における割付バイアスは、調査変数と、そのカテゴリ・スロットへの割付確率との関連
(共分散)によって決まります。たとえば、あるスロットへの回答におけるある調査変数についてみたとき、その調査変数の値が高い人ほど
そのスロットへの割付確率が高いとしましょう。このとき、そのスロットについての調査変数の標本平均は、
母平均と比べて高めになってしまいます。つまり、この調査変数において割付バイアスが生じます。いっぽう、調査変数と割付確率の間に全く関連がなかったら、この調査変数においては割付バイアスが生じません。このように、割付バイアスは調査変数によって異なります。割付バイアスの実際の大きさは、個々の調査変数についてしか評価できないわけです。</p>
<p>しかし、もし割付確率のばらつきが0に近ければ、割付バイアスはいずれの調査変数においても小さいことになります。なぜなら、たとえある調査変数と割付確率との関連が強かったとしても、割付確率そのものが回答のあいだで等しければ、バイアスは生じないからです。
そこで、調査変数が特定されない状況では、割付確率のばらつきを割付バイアスの大きさとして捉えることができます。</p>
<p>そこで’rSurveyAssign’パッケージでは、<strong>割付確率の変動係数</strong>(=SD/平均)を、割付バイアスの大きさの指標のひとつとして用いています。</p>
</div>
<div class="section level3">
<h3 id="デザイン効果">3.2 デザイン効果<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E5%8A%B9%E6%9E%9C"></a>
</h3>
<p>’rSurveyAssign’パッケージは、各対象者の各カテゴリ・スロットへの割付確率を推定します。推定値は割付確率は一定の誤差を含んでいますが、もし割付確率を正確に推定できているならば、割付確率の逆数を調査ウェイトとして集計することで、集計値における割付バイアスを取り除くことができます。</p>
<p>その反面、一般に、調査ウェイトを用いて集計すると集計値の分散は拡大します。集計値の分散は標本サイズが減少したときにも拡大しまから、調査ウェイトを用いた集計は、割付バイアスを取り除く反面、あたかも標本サイズを減らすかような効果を持つといえます。</p>
<p><strong>デザイン効果</strong>とは、バイアスの大きさを、調査ウェイトを使って集計することによって生じる仮想的な標本サイズの減少率として表現した値です。この値は、1+(割付確率の逆数の相対分散)として求められます。</p>
</div>
<div class="section level3">
<h3 id="実質標本サイズ">3.3 実質標本サイズ<a class="anchor" aria-label="anchor" href="#%E5%AE%9F%E8%B3%AA%E6%A8%99%E6%9C%AC%E3%82%B5%E3%82%A4%E3%82%BA"></a>
</h3>
<p>実際の標本サイズにデザイン効果を掛けた値を<strong>実質標本サイズ</strong>と呼びます。たとえば、実際の標本サイズが
100で、実質標本サイズが50であるとしましょう。これは、割付に伴って生じるバイアスの大きさが、それを取り除いたら標本サイズが
50に減ってしまう程度の大きさであるということを表しています。</p>
<p>私たちはふつう、割付確率の変動係数やデザイン効果について直観的に解釈できませんが、
標本サイズについてはなんらかの基準を持っていることが多いでしょう。いま、
いま、割付バイアスが生じないような調査を実現できるとして、その調査における標本サイズが100以下であったら「標本サイズが小さすぎる」と感じるとしましょう。このとき、割付バイアスが生じる調査において実質標本サイズが100以下であったら「割付バイアスが大きすぎる」と考えることができます。</p>
</div>
</div>
<div class="section level2">
<h2 id="バイアスの評価">4. バイアスの評価<a class="anchor" aria-label="anchor" href="#%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%81%AE%E8%A9%95%E4%BE%A1"></a>
</h2>
<p>では、バイアスを評価してみましょう。関数<code>getBias</code>を使います。</p>
<div class="section level3">
<h3 id="カテゴリごとのバイアス">3.1 カテゴリごとのバイアス<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AE%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9"></a>
</h3>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>cat</code>とすると、
各試行での各カテゴリごとのバイアスを評価することができます。
getBias`の返し値はデータフレームです。内容をみてみましょう。</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult1_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"cat"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_1.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfResult1_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   nTrial  nCat nFreq_Cat gCV_Prob_Cat gDeff_Cat gESS_Cat</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1     1      <span style="text-decoration: underline;">2</span>060        0.428      1.06    <span style="text-decoration: underline;">1</span>940.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1     2      <span style="text-decoration: underline;">1</span>956        0.181      1.01    <span style="text-decoration: underline;">1</span>927.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1     3      <span style="text-decoration: underline;">1</span>542        0.170      1.01    <span style="text-decoration: underline;">1</span>529.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      2     1      <span style="text-decoration: underline;">2</span>042        0.455      1.07    <span style="text-decoration: underline;">1</span>914.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      2     2      <span style="text-decoration: underline;">2</span>109        0.202      1.02    <span style="text-decoration: underline;">2</span>074.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      2     3      <span style="text-decoration: underline;">1</span>453        0.257      1.01    <span style="text-decoration: underline;">1</span>435.</span></span></code></pre></div>
<p>行は各割付試行における各カテゴリを表しています。</p>
<ul>
<li>変数
<code>nFreq_Cat</code>は、その割付試行におけるそのカテゴリに対する回答件数(すなわち、このカテゴリに割り付けられた延べ対象者数)を表しています。試行1ではカテゴリ1が2030回割り付けられました。</li>
<li>変数
<code>gCV_Prob_Cat</code>は割付確率の変動係数を表しています。0のときには割付バイアスがありません。大きいほど割付バイアスが大きいと考えられます。試行1では、カテゴリ1の割付における割付確率の変動係数が約0.42となりました。</li>
<li>変数<code>gDeff_Cat</code>は、カテゴリに対する回答におけるデザイン効果を表しています。1のときには割付バイアスがありません。1より大きいほど割付バイアスが大きいと考えられます。試行1では、カテゴリ1に対する回答におけるデザイン効果が約1.06となりました。</li>
<li>変数<code>gESS_Cat</code>は、カテゴリに対する回答の実質標本サイズを表しています。この値が回答件数と一致するときはバイアスがありません。それより小さいほど、バイアスが大きいと考えられます。試行1では、カテゴリ1に対する回答の実質標本サイズは約1939となりました。</li>
</ul>
<p>10回の割付試行を通じた、割付確率の変動係数のカテゴリ別平均を求めてみましょう。</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dfResult1_c</span><span class="op">$</span><span class="va">gCV_Prob_Cat</span>, <span class="va">dfResult1_c</span><span class="op">$</span><span class="va">nCat</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1         2         3 </span></span>
<span><span class="co">#&gt; 0.4419806 0.1976222 0.2136080</span></span></code></pre></div>
<p>割付確率の変動係数は0.19から0.44程度です。
特にカテゴリ1への回答において、かなりの割付バイアスが生じているようです。</p>
</div>
<div class="section level3">
<h3 id="スロットごとのバイアス">3.2 スロットごとのバイアス<a class="anchor" aria-label="anchor" href="#%E3%82%B9%E3%83%AD%E3%83%83%E3%83%88%E3%81%94%E3%81%A8%E3%81%AE%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9"></a>
</h3>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>slot</code>とすると、
各試行での各スロットへの回答におけるバイアスを調べることができます。</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult1_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"slot"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_1.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfResult1_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   nTrial  nCat nSlot nFreq_Slot gCV_Prob_Slot gDeff_Slot gESS_Slot</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1     1     1        100         0.592       7.35      13.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1     1     2        100         0.510       1.67      60.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1     1     3        100         0.485       1.49      67.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      1     1     4        100         0.600       3.52      28.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      1     1     5        100         0.177       1.02      98.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      1     1     6        100         0.516       1.90      52.6</span></span></code></pre></div>
<p>行は割付試行とスロットの組み合わせです。</p>
<ul>
<li>変数
<code>nFreq_Slot</code>は、その割付試行におけるそのスロットへの回答件数(そのスロットに割り付けられた延べ対象者数)を表しています。試行1ではカテゴリ1のスロット1への割付が100回生じました。</li>
<li>変数
<code>gCV_Prob_Slot</code>は割付確率の変動係数を表しています。0のときには割付バイアスがありません。大きいほど割付バイアスが大きいと考えられます。試行1のスロット1では、割付確率の変動係数が約0.59となりました。</li>
<li>変数<code>gDeff_Slot</code>は、スロットに対する回答におけるデザイン効果を表しています。1のときには割付バイアスがありません。1より大きいほど割付バイアスが大きいと考えられます。試行1では、カテゴリ1のスロット1に対する回答におけるデザイン効果が約7.4となりました。</li>
<li>変数<code>gESS_Slot</code>は、スロットに対する回答の実質標本サイズを表しています。この値が回答件数と一致するときは割付バイアスがありません。それより小さいほど割付バイアスが大きいと考えられます。試行1では、カテゴリ1のスロット1に対する回答の実質標本サイズは約13.6となりました。</li>
</ul>
<p>10回の割付試行を通じた、デザイン効果のスロット別平均を求めましょう。</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dfResult1_s</span><span class="op">$</span><span class="va">gCV_Prob_Slot</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dfResult1_s</span><span class="op">$</span><span class="va">nCat</span>, <span class="va">dfResult1_s</span><span class="op">$</span><span class="va">nSlot</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           1         2         3         4         5         6         7</span></span>
<span><span class="co">#&gt; 1 0.5538861 0.4544750 0.5604406 0.5734400 0.2237889 0.5441021 0.5629954</span></span>
<span><span class="co">#&gt; 2 0.3901738 0.5521363 0.4686567 0.1155227 0.5505147 0.2076348 0.1241414</span></span>
<span><span class="co">#&gt; 3 0.4742899 0.2250081 0.5220010 0.3618042 0.4678618 0.1772645 0.5257441</span></span>
<span><span class="co">#&gt;           8         9        10</span></span>
<span><span class="co">#&gt; 1 0.5670633 0.5228311 0.3730466</span></span>
<span><span class="co">#&gt; 2 0.4672756 0.1853742 0.1907360</span></span>
<span><span class="co">#&gt; 3 0.4621659 0.5187052 0.2557844</span></span></code></pre></div>
<p>割付確率の変動係数は平均して0.12から0.57程度です。スロットの回答における割付バイアスもかなり大きいようです。</p>
</div>
</div>
<div class="section level2">
<h2 id="評価指標の偏り">5. 評価指標の偏り<a class="anchor" aria-label="anchor" href="#%E8%A9%95%E4%BE%A1%E6%8C%87%E6%A8%99%E3%81%AE%E5%81%8F%E3%82%8A"></a>
</h2>
<p>現バージョンの<code>rSurveyAssign</code>パッケージが提供する割付バイアスの評価指標
(割付確率の変動係数、デザイン効果、実質標本サイズ)は、いずれも少し悲観的な方向に偏っています。
そのことを、以下の例でみてみましょう。</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 割付のセッティング</span></span>
<span><span class="va">lSetting2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeSetting.html">makeSetting</a></span><span class="op">(</span></span>
<span>  lSLOT_REQUEST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lSlot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  nCAT_MAX <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  sCAT_TYPE <span class="op">=</span> <span class="st">'nonadaptive'</span>, </span>
<span>  sCAT_FILTER <span class="op">=</span> <span class="st">'open'</span>, </span>
<span>  sCAT_ORDER  <span class="op">=</span> <span class="st">'shortnum'</span>, </span>
<span>  sCAT_EXCLUDE <span class="op">=</span> <span class="st">'none'</span>,</span>
<span>  nSLOT_MAX <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  sSLOT_TYPE <span class="op">=</span> <span class="st">'nonadaptive'</span>, </span>
<span>  sSLOT_FILTER <span class="op">=</span> <span class="st">'open'</span>, </span>
<span>  sSLOT_ORDER  <span class="op">=</span> <span class="st">'shortnum'</span>, </span>
<span>  sSLOT_EXCLUDE <span class="op">=</span> <span class="st">'none'</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="co">## 都合によりコメントアウトしています</span></span>
<span><span class="co"># simBias (</span></span>
<span><span class="co">#   lPOP       = lPop, </span></span>
<span><span class="co">#   lSETTING   = lSetting2, </span></span>
<span><span class="co">#   sDBPATH    = "../tools/rSurveyAssign_vignette_bias_2.sqlite",</span></span>
<span><span class="co">#   nNUMTRIAL  = 10,</span></span>
<span><span class="co">#   nNUMRETRIAL = 500,</span></span>
<span><span class="co">#   bAPPEND    = FALSE, </span></span>
<span><span class="co">#   bPARALLEL  = TRUE,</span></span>
<span><span class="co">#   sLOGFILE   = "c:/work/simWeight.log"</span></span>
<span><span class="co"># )</span></span></code></pre></div>
<p>割付確率の変動係数を調べてみましょう。</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult2_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"cat"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_2.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dfResult2_c</span><span class="op">$</span><span class="va">gCV_Prob_Cat</span>, <span class="va">dfResult2_c</span><span class="op">$</span><span class="va">nCat</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          1          2          3 </span></span>
<span><span class="co">#&gt; 0.04938899 0.03576083 0.05080480</span></span></code></pre></div>
<p>カテゴリ別の割付確率の変動係数は0.03から0.05程度です。</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult2_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"slot"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_2.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dfResult2_s</span><span class="op">$</span><span class="va">gCV_Prob_Slot</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dfResult2_s</span><span class="op">$</span><span class="va">nCat</span>, <span class="va">dfResult2_s</span><span class="op">$</span><span class="va">nSlot</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           1         2         3          4          5          6          7</span></span>
<span><span class="co">#&gt; 1 0.1727264 0.1182665 0.1448768 0.14666682 0.06971197 0.14247862 0.10226042</span></span>
<span><span class="co">#&gt; 2 0.1964570 0.1651830 0.1322604 0.06435808 0.17132514 0.11955243 0.06548126</span></span>
<span><span class="co">#&gt; 3 0.1702828 0.1189525 0.1568602 0.14258432 0.15610010 0.07176902 0.16079040</span></span>
<span><span class="co">#&gt;           8          9         10</span></span>
<span><span class="co">#&gt; 1 0.1280557 0.17413341 0.19118275</span></span>
<span><span class="co">#&gt; 2 0.1615011 0.07394842 0.08432121</span></span>
<span><span class="co">#&gt; 3 0.1604569 0.17640832 0.11252825</span></span></code></pre></div>
<p>スロット別の割付確率の変動係数は0.06から0.19程度です。</p>
<p>本項で試した割付方法は、カテゴリについてもスロットについても非適応的かつ除外条件のない割付方法を採用し、
かつ割付カテゴリの最大数は1でした。 <a href="vignette.html">“rSurveyAssign: run simulations of assignments for
web surveys”</a>で述べたように、
これらの割り付け方法では割付バイアスは生じないはずです。</p>
<p>ところが、割付確率の変動係数は0に近い値になったものの、0にはなりませんでした。これは
割付確率の推定に誤差があるためです。誤差は再割当試行数を大きくすれば小さくなりますが、0にはなりません。
そのため、割付確率の変動係数は、真の変動係数と比べ、誤差による変動のぶんだけ大きめに偏ってしまいます。</p>
<p>現バージョンの<code>rSurveyAssign</code>パッケージは、この偏りを修正する方法を実装していません。
そのため、割付バイアスの評価指標はいずれも少し大きめになっています。
これらの指標は、あくまで相対的な指標として捉え、割付方法間の比較にのみ用いることをお勧めします。</p>
</div>
<div class="section level2">
<h2 id="まとめ-バイアス評価に関連する関数">6. まとめ: バイアス評価に関連する関数<a class="anchor" aria-label="anchor" href="#%E3%81%BE%E3%81%A8%E3%82%81-%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E8%A9%95%E4%BE%A1%E3%81%AB%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B%E9%96%A2%E6%95%B0"></a>
</h2>
<p><code>rSurveyAssign</code>パッケージが提供する関数のうち、バイアス評価に関連する関数は以下の通りです。</p>
<ul>
<li>
<code>makePop</code>: 母集団データを作成する</li>
<li>
<code>makeSetting</code>: 割付のセッティングを作成する</li>
<li>
<code>simBias</code>:
シミュレーションを実行し結果をデータベースに格納する</li>
<li>
<code>getBias</code>:
データベースに格納されたシミュレーション結果を集計して取り出す</li>
<li>
<code>countBias</code>:
データベースに格納されたシミュレーション結果の試行数を調べる</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Shigeru ONO.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
