<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rSurveyAssign">
<title>How to forecast sample size • rSurveyAssign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to forecast sample size">
<meta property="og:description" content="rSurveyAssign">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rSurveyAssign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">rSurveyAssign: tools for simulation of assignment in web surveys</a>
    <a class="dropdown-item" href="../articles/vignette_assign.html">How to assign subjects</a>
    <a class="dropdown-item" href="../articles/vignette_bias.html">How to estimate bias</a>
    <a class="dropdown-item" href="../articles/vignette_size.html">How to forecast sample size</a>
    <a class="dropdown-item" href="../articles/vignette_weight.html">How to compute survey weights</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to forecast sample size</h1>
                        <h4 data-toc-skip class="author">Shigeru
ONO</h4>
            
            <h4 data-toc-skip class="date">2024-03-25</h4>
      
      
      <div class="d-none name"><code>vignette_size.Rmd</code></div>
    </div>

    
    
<p>ここでは、<code>rSurveyAssign</code>パッケージを使った標本サイズ推定について
説明します。</p>
<p><code>rSurveyAssign</code>パッケージの背後にある考え方については、 <a href="vignette.html">“rSurveyAssign: tools for simulation of assignment
in web surveys”</a>を参照して下さい。</p>
<div class="section level2">
<h2 id="データの準備">1. データの準備<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99"></a>
</h2>
<div class="section level3">
<h3 id="母集団データ">1.1 母集団データ<a class="anchor" aria-label="anchor" href="#%E6%AF%8D%E9%9B%86%E5%9B%A3%E3%83%87%E3%83%BC%E3%82%BF"></a>
</h3>
<p>まず、母集団を表現するデータを用意します。</p>
<p>このデータは、母集団を有限集団として近似的に表現するものです。母集団メンバーそれぞれ
について、カテゴリ・スロットへの割付可能性を記述します。</p>
<p><code>rSurveyAssign</code>は、母集団データをつくる機能は提供していません。
過去の調査結果や既存の知識に基づき、なんとかして作ってください。</p>
<p>以下では、母集団メンバーを<span class="math inline">\(i
(=1,\ldots,I)\)</span>, カテゴリを<span class="math inline">\(j(=1,\ldots,J)\)</span>, カテゴリ<span class="math inline">\(j\)</span>のスロットを<span class="math inline">\(k (=1,\ldots,K_j)\)</span>と表記します。</p>
<p>データのサイズ(<span class="math inline">\(I, J,
K_1,...,K_J\)</span>)に制限はありません。母集団のメンバー数 <span class="math inline">\(I\)</span>
はできるだけ大きくしたほうがよいでしょう。</p>
<p>母集団データの例として、<code>popdata</code>が用意されています。
<code>popdata</code>は、サイズ10000の有限集団のデータを持つデータフレームで、
カテゴリ数は3, スロット数は 各カテゴリについて10です(すなわち、<span class="math inline">\(I=10000, J=3, K_1=K_2=K_3=10\)</span>)。</p>
<p>内容をみてみましょう。</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shigono.github.io/rSurveyAssign/">rSurveyAssign</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">popdata</span>, package <span class="op">=</span> <span class="st">"rSurveyAssign"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;   nID bCat_1 bCat_2 bCat_3 bSlot_1_1 bSlot_1_2 bSlot_1_3 bSlot_1_4 bSlot_1_5</span></span>
<span><span class="co">#&gt; 1   1      1      1      1         1         0         0         1         0</span></span>
<span><span class="co">#&gt; 2   2      1      1      1         1         1         1         1         0</span></span>
<span><span class="co">#&gt; 3   3      1      1      1         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 4   4      0      0      0        NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; 5   5      1      1      1         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 6   6      1      1      1         0         0         0         0         0</span></span>
<span><span class="co">#&gt;   bSlot_1_6 bSlot_1_7 bSlot_1_8 bSlot_1_9 bSlot_1_10 bSlot_2_1 bSlot_2_2</span></span>
<span><span class="co">#&gt; 1         0         0         1         1          1         1         1</span></span>
<span><span class="co">#&gt; 2         0         0         0         1          0         1         0</span></span>
<span><span class="co">#&gt; 3         0         0         0         0          0         0         0</span></span>
<span><span class="co">#&gt; 4        NA        NA        NA        NA         NA        NA        NA</span></span>
<span><span class="co">#&gt; 5         1         0         0         0          0         0         0</span></span>
<span><span class="co">#&gt; 6         0         0         0         0          0         0         0</span></span>
<span><span class="co">#&gt;   bSlot_2_3 bSlot_2_4 bSlot_2_5 bSlot_2_6 bSlot_2_7 bSlot_2_8 bSlot_2_9</span></span>
<span><span class="co">#&gt; 1         0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 2         1         0         1         0         0         0         0</span></span>
<span><span class="co">#&gt; 3         0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 4        NA        NA        NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; 5         0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 6         0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt;   bSlot_2_10 bSlot_3_1 bSlot_3_2 bSlot_3_3 bSlot_3_4 bSlot_3_5 bSlot_3_6</span></span>
<span><span class="co">#&gt; 1          0         1         0         0         0         1         0</span></span>
<span><span class="co">#&gt; 2          0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 3          0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 4         NA        NA        NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; 5          0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt; 6          0         0         0         0         0         0         0</span></span>
<span><span class="co">#&gt;   bSlot_3_7 bSlot_3_8 bSlot_3_9 bSlot_3_10</span></span>
<span><span class="co">#&gt; 1         0         0         1          0</span></span>
<span><span class="co">#&gt; 2         0         0         0          0</span></span>
<span><span class="co">#&gt; 3         0         0         0          0</span></span>
<span><span class="co">#&gt; 4        NA        NA        NA         NA</span></span>
<span><span class="co">#&gt; 5         0         0         0          0</span></span>
<span><span class="co">#&gt; 6         0         0         0          0</span></span></code></pre></div>
<p>行は母集団のメンバーを表しています。</p>
<p>変数<code>bCat_(i)</code>は、カテゴリ<span class="math inline">\(i\)</span>への割付可能性を表しています。
たとえば母集団メンバー1は、カテゴリ1,2,3に割付可能です。母集団メンバー4は、どのカテゴリにも割付不能です。</p>
<p>変数<code>bSlot_(i)_(j)</code>は、カテゴリ<span class="math inline">\(i\)</span>のスロット<span class="math inline">\(j\)</span>の割付可能性を表しています。
たとえば母集団メンバー1は、カテゴリ1のスロットのうち、スロット1, 4, 8,
9, 20に対して 割付可能です。</p>
</div>
<div class="section level3">
<h3 id="popdataオブジェクトの生成">1.2 popdataオブジェクトの生成<a class="anchor" aria-label="anchor" href="#popdata%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%94%9F%E6%88%90"></a>
</h3>
<p>次に、母集団データを<code>rSurveyAssign</code>パッケージが扱える形式に変換します。</p>
<p><code>rSurveyAssign</code>パッケージは、母集団データを表すクラス<code>popdata</code>を用意しています。
<code>popdata</code>クラスのオブジェクトは、関数<code>makePop</code>で作成します。</p>
<p>関数<code>makePop</code>の引数は次の2つです。</p>
<ul>
<li>
<code>mbCAT</code>: カテゴリ割付可能性。
<ul>
<li>
<span class="math inline">\(I\)</span>行<span class="math inline">\(J\)</span>列の整数行列。</li>
<li>
<span class="math inline">\(i\)</span>行<span class="math inline">\(j\)</span>列の値は、「母集団メンバー<span class="math inline">\(i\)</span>にとってカテゴリ<span class="math inline">\(j\)</span>は割付可能か」 を表し、<span class="math inline">\(0\)</span>は割付不能, <span class="math inline">\(1\)</span>は割付可能を表します。</li>
<li>欠損は許容されません。</li>
</ul>
</li>
<li>
<code>lSLOT</code>: スロット割付可能性。
<ul>
<li>
<span class="math inline">\(J\)</span>個の要素からなるリスト。<span class="math inline">\(j\)</span>番目の要素は、<span class="math inline">\(I\)</span>行<span class="math inline">\(K_j\)</span>列の整数行列。</li>
<li>要素<span class="math inline">\(j\)</span>の行列の<span class="math inline">\(i\)</span>行<span class="math inline">\(k\)</span>列の値は、「母集団メンバー<span class="math inline">\(i\)</span>にとって カテゴリ<span class="math inline">\(j\)</span>のスロット<span class="math inline">\(k\)</span>は割付可能か」を表し、<span class="math inline">\(0\)</span>は割付不能, <span class="math inline">\(1\)</span>は割付可能を表します。</li>
<li>
<code>mbCAT[i,j] == 1</code>のとき、<code>lSLOT[[j]][i,]}</code>の欠損は許容されません。
すなわち、割付可能カテゴリに属するスロットの割付可能性は指定する必要があります。</li>
<li>
<code>mbCAT[i,j] == 0</code>のとき、<code>lSLOT[[j]][i,]</code>は無視されます。すなわち、割付不能カテゴリに属するスロットの割付可能性は無視されます。従って欠損も許容されます。</li>
</ul>
</li>
</ul>
<p>では、データ例を<code>popdata</code>クラスのオブジェクトに変換しましょう。</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mbCat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bCat_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lSlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_1_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_2_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_3_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">lPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makePop.html">makePop</a></span><span class="op">(</span>mbCAT <span class="op">=</span> <span class="va">mbCat</span>, lSLOT <span class="op">=</span> <span class="va">lSlot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [makePop] assign colnames to lSLOT ...</span></span>
<span><span class="co">#&gt; [makePop] # of categories: 3 </span></span>
<span><span class="co">#&gt; [makePop] # of slots: 10,10,10 </span></span>
<span><span class="co">#&gt; [makePop] # of members: 10000 </span></span>
<span><span class="co">#&gt; [makePop] # of member-category pairs which are assignable: 26488 (8829.3/category) </span></span>
<span><span class="co">#&gt; [makePop] # of member-slot pairs which are assignable: 58836 (1961.2/slot)</span></span></code></pre></div>
<p>無事に変換できました。</p>
</div>
</div>
<div class="section level2">
<h2 id="セッティング">2. セッティング<a class="anchor" aria-label="anchor" href="#%E3%82%BB%E3%83%83%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"></a>
</h2>
<p>次に、割付のセッティングを指定します。ここでいうセッティングとは、以下を指します。</p>
<ul>
<li>各スロットの目標対象者数</li>
<li>対象者に割り付けるカテゴリ数の上限</li>
<li>カテゴリ割付の方法</li>
<li>対象者に割り付けるスロット数の上限</li>
<li>スロット割付の方法</li>
</ul>
<p><code>rSurveyAssign</code>パッケージは、セッティングを表すクラス<code>assignsetting</code>を用意しています。
<code>assignsetting</code>クラスのオブジェクトは、関数<code>makeSetting</code>で作成します。</p>
<p>関数<code>makeSetting</code>の引数は次のとおりです。</p>
<ul>
<li>
<code>lSLOT_REQUEST</code>: 各スロットの目標対象者数。
<ul>
<li>
<span class="math inline">\(J\)</span>個の要素を持つリスト。<span class="math inline">\(j\)</span>番目の要素は長さ<span class="math inline">\(K_j\)</span>の整数ベクトル。</li>
<li>
<span class="math inline">\(j\)</span>番目の要素であるベクトルの<span class="math inline">\(k\)</span>番目の要素は、カテゴリ<span class="math inline">\(j\)</span>のスロット<span class="math inline">\(k\)</span>に割り付ける対象者数の下限を表します。
欠損は許容されません。</li>
</ul>
</li>
<li>
<code>nCAT_MAX</code>: 割付カテゴリの最大数。</li>
<li>
<code>nSLOT_MAX</code>: 割付スロットの最大数。</li>
<li>
<code>sCAT_TYPE</code>: カテゴリの割付方法(割付タイプ)。</li>
<li>
<code>sCAT_FILTER</code>: カテゴリの割付方法(絞り込み条件)。</li>
<li>
<code>sCAT_ORDER</code>: カテゴリの割付方法(順序付け条件)。</li>
<li>
<code>sCAT_EXCLUDE</code>: カテゴリの割付方法(除外条件)。</li>
<li>
<code>sSLOT_TYPE</code>: スロットの割付方法(割付タイプ)。</li>
<li>
<code>sSLOT_FILTER</code>: スロットの割付方法(絞り込み条件)。</li>
<li>
<code>sSLOT_ORDER</code>: スロットの割付方法(順序付け条件)。</li>
<li>
<code>sSLOT_EXCLUDE</code>: スロットの割付方法(除外条件)。</li>
</ul>
<p>カテゴリ・スロットの割付方法については <a href="vignette_assign.html">“How to assign
subjects”</a>を参照して下さい。</p>
<p>では、セッティングを指定しましょう。</p>
<ul>
<li>すべてのカテゴリのすべてのスロットに、すくなくとも10人の対象者を割り付けることにします。</li>
<li>回答負荷の観点から、ひとりの対象者が割り付けられるカテゴリは2つまで、スロットは2つまでとします。</li>
<li>カテゴリの割付方法(割付タイプ、絞り込み条件、順序付け条件、除外条件)として(adaptive,open,random,none)を使用し、スロットの割付方法として(adaptive,all,shortnum,allclosed)を使用します。</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lSetting</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeSetting.html">makeSetting</a></span><span class="op">(</span></span>
<span>  lSLOT_REQUEST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lSlot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  nCAT_MAX      <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  nSLOT_MAX     <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  sCAT_TYPE     <span class="op">=</span> <span class="st">'adaptive'</span>,</span>
<span>  sCAT_FILTER   <span class="op">=</span> <span class="st">'open'</span>,</span>
<span>  sCAT_ORDER    <span class="op">=</span> <span class="st">'random'</span>,</span>
<span>  sCAT_EXCLUDE  <span class="op">=</span> <span class="st">'none'</span>,</span>
<span>  sSLOT_TYPE    <span class="op">=</span> <span class="st">'adaptive'</span>,</span>
<span>  sSLOT_FILTER  <span class="op">=</span> <span class="st">'all'</span>,</span>
<span>  sSLOT_ORDER   <span class="op">=</span> <span class="st">'shortnum'</span>,</span>
<span>  sSLOT_EXCLUDE <span class="op">=</span> <span class="st">'allclosed'</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [makeSetting] assign names to lSLOT_REQUEST ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="割付シミュレーション">3. 割付シミュレーション<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"></a>
</h2>
<p>では、必要な標本サイズを推定するために、シミュレーションを行ってみましょう。</p>
<p>このシミュレーションでは、母集団データから対象者を復元抽出し、
それぞれの対象者に、指定した方法でカテゴリ・スロットへの割付を行います。
これを<strong>割付試行</strong>と呼びます。</p>
<p>割付試行を十分な回数繰り返せば、指定した方法で割付を行ったときに必要な標本サイズを
推定することができます。</p>
<div class="section level3">
<h3 id="試行の実行">3.1 1試行の実行<a class="anchor" aria-label="anchor" href="#%E8%A9%A6%E8%A1%8C%E3%81%AE%E5%AE%9F%E8%A1%8C"></a>
</h3>
<p>まず、割付試行を1回行ってみます。</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="va">dfResult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simSize.html">simSize</a></span> <span class="op">(</span></span>
<span>  lPOP     <span class="op">=</span> <span class="va">lPop</span>,           <span class="co"># データを指定する</span></span>
<span>  lSETTING <span class="op">=</span> <span class="va">lSetting</span>        <span class="co"># セッティングを指定する</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [execTrials] start trials (serial) ...</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 1 ; extract: 573 ; 0.048 sec.</span></span>
<span><span class="co">#&gt; [execTrials] end trials.</span></span></code></pre></div>
<p>コンソールに表示されるメッセージは、各試行の結果を表しています。この試行では、母集団から調査対象者を573人抽出したところで、
目標対象者数が満たされ、調査が終了しました。</p>
<p>シミュレーションの結果をみてみましょう。</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfResult</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   sRowname nPerson nCat1 nCat2  nCat nSlot1 nSlot2 nTrial nSubject</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           <span style="text-decoration: underline;">6</span>779     3     2     3      7     <span style="color: #BB0000;">NA</span>      1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2           <span style="text-decoration: underline;">5</span>953     3     1     3      9     10      1        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3           <span style="text-decoration: underline;">3</span>232     2     1    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4           <span style="text-decoration: underline;">1</span>226     2     1     2      7      5      1        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5           <span style="text-decoration: underline;">5</span>372     1    <span style="color: #BB0000;">NA</span>     1      7     10      1        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6           <span style="text-decoration: underline;">7</span>652     1     2     1      2      1      1        6</span></span></code></pre></div>
<p>このシミュレーションでは、1人目の調査対象者として母集団メンバー6779が抽出されました。カテゴリ割付の結果、カテゴリ2,3が割り付けられました。スロット割付の結果、カテゴリ3のスロット7が割り付けられました。</p>
<p>このシミュレーションで、各スロットには何人の対象者が割り付けられたのでしょうか？
調べてみましょう。</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mnIn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dfResult</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nCat"</span>, <span class="st">"nSlot1"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dfResult</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nCat"</span>, <span class="st">"nSlot2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mnIn</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">mnIn</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;      1  2  3  4  5  6  7  8  9 10</span></span>
<span><span class="co">#&gt;   1 12 11 10 11 10 11 11 11 13 12</span></span>
<span><span class="co">#&gt;   2 13 14 13 10 12 13 10 13 10 10</span></span>
<span><span class="co">#&gt;   3 11 11 11 11 12 10 11 11 12 11</span></span></code></pre></div>
<p>上の表は、行がカテゴリ、列がスロット、値がそのスロットに割り付けられた人数を表しています。すべてのスロットに10人以上が割り付けられていることを確認できます。</p>
</div>
<div class="section level3">
<h3 id="多くの試行の実行と保存">3.2 多くの試行の実行と保存<a class="anchor" aria-label="anchor" href="#%E5%A4%9A%E3%81%8F%E3%81%AE%E8%A9%A6%E8%A1%8C%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%A8%E4%BF%9D%E5%AD%98"></a>
</h3>
<p>上の例では、割付試行を1回行い、
シミュレーションの結果をデータフレームとして取得しました。</p>
<p>標本サイズを推定するには、十分な数の割付試行を繰り返す必要があります。
そこで今度は、割付試行を20試行繰り返してみましょう。</p>
<p>シミュレーションの結果はサイズが大きいので、いったんSQLiteデータベース上に
保存したほうがよいでしょう。 以下の例では、
SQLiteデータベースファイルとして、<code>../tools/rSurveyAssign_vignette_size_1.sqlite</code>を
作成します。実際には、適切なフォルダとファイル名を指定してください。また、
データベースファイルは必要がなくなったら自分で消してください。</p>
<p>実行時間を短くするため、並列処理を行うことにします。引数<code>bPARALLEL</code>にTRUEを指定します。
並列処理を行う場合、各試行についてのメッセージは画面に表示されません。
そこでログファイルを作成することにします。
実行に長い時間がかかる場合は、ログファイルを監視すると、
いま何試行まで進んでいるかわかり、少しだけ心が癒されるでしょう。</p>
<p>下の例では、ログファイルを<code>C:/work/simSize.log</code>としています。
RStudioを使っているなら、Terminalウィンドウで<code>tail -F C:/work/simSize.log</code>を
実行すると、ログファイルを監視できます。</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="co">## 都合によりコメントアウトしています</span></span>
<span><span class="co"># dfResult &lt;- simSize (</span></span>
<span><span class="co">#   lPOP      =  lPop,          </span></span>
<span><span class="co">#   lSETTING  = lSetting, </span></span>
<span><span class="co">#   nNUMTRIAL = 20,</span></span>
<span><span class="co">#   bPARALLEL = TRUE,</span></span>
<span><span class="co">#   sLOGFILE  = "c:/work/simSize.log",</span></span>
<span><span class="co">#   sDBPATH   = "../tools/rSurveyAssign_vignette_size_1.sqlite", </span></span>
<span><span class="co">#   bAPPEND   = FALSE # すでにデータベースが存在する場合は上書きする</span></span>
<span><span class="co"># )</span></span></code></pre></div>
<p>関数<code>getSize_raw</code>で、
データベースに格納された結果をそのまま取り出すことができます。</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/getSize_raw.html">getSize_raw</a></span><span class="op">(</span><span class="st">"../tools/rSurveyAssign_vignette_size_1.sqlite"</span>, nTRIAL <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   sRowname nPerson nCat1 nCat2  nCat nSlot1 nSlot2 nTrial nSubject</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           <span style="text-decoration: underline;">8</span>470     2     1     2      1      2      1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2           <span style="text-decoration: underline;">9</span>210     2     3    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3           <span style="text-decoration: underline;">5</span>801     3     1     3      2     <span style="color: #BB0000;">NA</span>      1        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4           <span style="text-decoration: underline;">6</span>816     2     3     2      3      8      1        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5           <span style="text-decoration: underline;">4</span>868    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6            688     3     2     3      6      3      1        6</span></span></code></pre></div>
<p>なお、これまでにデータベースに格納した試行数は、格納した際に表示されますが、
関数<code>countSize</code>で調べることもできます。</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/countSize.html">countSize</a></span><span class="op">(</span><span class="st">"../tools/rSurveyAssign_vignette_size_1.sqlite"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>この例では、試行には1秒以下しかかかりませんが、
もっと長い時間がかかることもあるでしょう。そうした場合に、
試行数<code>nNUMTRIAL</code>を大きくすると、
<code>simSize</code>の実行にとても長い時間がかかることになり、不便です。</p>
<p>このような場合は、<code>nNUMTRIAL</code>はあまり時間がかからない程度の大きさにとどめ、
<code>simSize</code>を気が向いたときに繰り返し実行して、結果を少しずつデータベースに
蓄積していくのが良いでしょう。</p>
<p>その際は、初回実行時には引数<code>bAPPEND</code>をFALSEとし、
二回目以降の実行時にはTRUEとしてください。また、引数<code>lPOP</code>,
<code>lSETTING</code>に与える値を途中で変えないように注意して下さい(少しでも変えるとエラーとなります)。</p>
</div>
</div>
<div class="section level2">
<h2 id="標本サイズの推定">4. 標本サイズの推定<a class="anchor" aria-label="anchor" href="#%E6%A8%99%E6%9C%AC%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E6%8E%A8%E5%AE%9A"></a>
</h2>
<p>データベースに格納されている試行結果を集計して取り出すためには、
関数<code>getSize</code>を使います。</p>
<div class="section level3">
<h3 id="調査対象者数">4.1 調査対象者数<a class="anchor" aria-label="anchor" href="#%E8%AA%BF%E6%9F%BB%E5%AF%BE%E8%B1%A1%E8%80%85%E6%95%B0"></a>
</h3>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>subject</code>とすると、
各試行における調査対象者数を調べることができます。</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSize.html">getSize</a></span> <span class="op">(</span></span>
<span>  sTYPE   <span class="op">=</span> <span class="st">"subject"</span>,</span>
<span>  sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_size_1.sqlite"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dfResult_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 3</span></span></span>
<span><span class="co">#&gt;    nTrial nNum_scr nNum_main</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1      451       189</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2      475       191</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3      496       182</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4      399       179</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5      441       188</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6      568       186</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7      643       192</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8      451       186</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9      764       190</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10      529       187</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     11      454       187</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     12      546       195</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     13      440       182</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     14      489       191</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     15      597       189</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     16      531       187</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     17      595       194</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     18      511       193</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     19      483       198</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     20      542       187</span></span></code></pre></div>
<p><code>nNum_scr</code>は調査対象者数,
<code>nNum_main</code>はそのうち1つ以上のスロットに割り付けられた人数を表しています。</p>
<p>ここでは試行回数はまだ20件しかありませんが、試しに<code>nNum_scr</code>の平均を求めてみましょう。</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dfResult_s</span><span class="op">$</span><span class="va">nNum_scr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 520.25</span></span></code></pre></div>
<p>必要な調査対象者数の平均は約520人となりました。</p>
<p>試行回数を十分に増やした上で、 <code>nNum_scr</code>を平均すると、
必要な調査対象者数の期待値を推測することができます。
また、<code>nNum_scr</code>のヒストグラムを描くことで、必要な調査対象者数の分布を観察できます。</p>
</div>
<div class="section level3">
<h3 id="カテゴリスロットあたり調査対象者数">4.2 カテゴリ・スロットあたり調査対象者数<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%82%B9%E3%83%AD%E3%83%83%E3%83%88%E3%81%82%E3%81%9F%E3%82%8A%E8%AA%BF%E6%9F%BB%E5%AF%BE%E8%B1%A1%E8%80%85%E6%95%B0"></a>
</h3>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>cat</code>とすると、各カテゴリの割付人数を調べることができます。</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSize.html">getSize</a></span> <span class="op">(</span></span>
<span>  sTYPE   <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_size_1.sqlite"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dfResult_c</span><span class="op">$</span><span class="va">nNum</span>, <span class="va">dfResult_c</span><span class="op">$</span><span class="va">nCat</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      1      2      3 </span></span>
<span><span class="co">#&gt; 383.10 409.20 308.95</span></span></code></pre></div>
<p>カテゴリ1, 2, 3の割付人数は、平均してそれぞれ約383人, 409人,
308人となりました。</p>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>slot</code>とすると、各スロットの割付人数を調べることができます。</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSize.html">getSize</a></span> <span class="op">(</span></span>
<span>  sTYPE   <span class="op">=</span> <span class="st">"slot"</span>,</span>
<span>  sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_size_1.sqlite"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dfResult_s</span><span class="op">$</span><span class="va">nNum</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dfResult_s</span><span class="op">$</span><span class="va">nCat</span>, <span class="va">dfResult_s</span><span class="op">$</span><span class="va">nSlot</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       1     2     3     4    5     6     7     8     9    10</span></span>
<span><span class="co">#&gt; 1 11.35 11.00 11.00 11.15 10.0 11.10 10.85 11.10 12.00 12.50</span></span>
<span><span class="co">#&gt; 2 13.65 12.65 12.35 10.35 12.8 12.05 10.60 12.60 10.60 11.05</span></span>
<span><span class="co">#&gt; 3 11.20 10.65 11.10 10.80 11.1 10.05 11.00 10.95 10.95 10.55</span></span></code></pre></div>
<p>たとえば、カテゴリ1のスロット1の割付人数は、平均して約11.4人となりました。</p>
</div>
</div>
<div class="section level2">
<h2 id="分析例-割付方法の比較">5. 分析例: 割付方法の比較<a class="anchor" aria-label="anchor" href="#%E5%88%86%E6%9E%90%E4%BE%8B-%E5%89%B2%E4%BB%98%E6%96%B9%E6%B3%95%E3%81%AE%E6%AF%94%E8%BC%83"></a>
</h2>
<p>調査に必要な対象者数がカテゴリ割付・スロット割付の方法によって
どのように変わるかを、シミュレーションによって推測することができます。</p>
<p>たとえば、スロット割付の方法を(adaptive,all,shortnum,allclosed)に変更して
シミュレーションしてみます。
SQLiteデータベースファイルとして、<code>../tools/rSurveyAssign_demo2.sqlite</code>を
作成します。</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lSetting2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeSetting.html">makeSetting</a></span><span class="op">(</span></span>
<span>  lSLOT_REQUEST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lSlot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  nCAT_MAX      <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  sCAT_TYPE     <span class="op">=</span> <span class="st">'adaptive'</span>,</span>
<span>  sCAT_FILTER   <span class="op">=</span> <span class="st">'open'</span>,</span>
<span>  sCAT_ORDER    <span class="op">=</span> <span class="st">'random'</span>,</span>
<span>  sCAT_EXCLUDE  <span class="op">=</span> <span class="st">'none'</span>,</span>
<span>  nSLOT_MAX     <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  sSLOT_TYPE    <span class="op">=</span> <span class="st">'adaptive'</span>,</span>
<span>  sSLOT_FILTER  <span class="op">=</span> <span class="st">'all'</span>,</span>
<span>  sSLOT_ORDER   <span class="op">=</span> <span class="st">'random'</span>,</span>
<span>  sSLOT_EXCLUDE <span class="op">=</span> <span class="st">'allclosed'</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [makeSetting] assign names to lSLOT_REQUEST ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="fu"><a href="../reference/simSize.html">simSize</a></span> <span class="op">(</span></span>
<span>  lPOP           <span class="op">=</span> <span class="va">lPop</span>,        </span>
<span>  lSETTING       <span class="op">=</span> <span class="va">lSetting2</span>, </span>
<span>  nNUMTRIAL      <span class="op">=</span> <span class="fl">20</span>,              </span>
<span>  sDBPATH        <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_size_2.sqlite"</span>, </span>
<span>  bAPPEND        <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [execTrials] start trials (serial) ...</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 1 ; extract: 1235 ; 0.071 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 2 ; extract: 1303 ; 0.053 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 3 ; extract: 1201 ; 0.064 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 4 ; extract: 1505 ; 0.063 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 5 ; extract: 1380 ; 0.064 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 6 ; extract: 1234 ; 0.057 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 7 ; extract: 1177 ; 0.055 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 8 ; extract: 1371 ; 0.059 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 9 ; extract: 1041 ; 0.052 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 10 ; extract: 1385 ; 0.069 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 11 ; extract: 1081 ; 0.054 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 12 ; extract: 1555 ; 0.065 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 13 ; extract: 979 ; 0.049 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 14 ; extract: 1495 ; 0.058 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 15 ; extract: 1128 ; 0.055 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 16 ; extract: 1072 ; 0.051 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 17 ; extract: 1437 ; 0.059 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 18 ; extract: 1157 ; 0.052 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 19 ; extract: 1158 ; 0.056 sec.</span></span>
<span><span class="co">#&gt; [execTrials] nTrial: 20 ; extract: 991 ; 0.051 sec.</span></span>
<span><span class="co">#&gt; [execTrials] end trials.</span></span>
<span><span class="co">#&gt; [simSize] # Accumlated Trials: 20</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="va">dfResult2_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSize.html">getSize</a></span> <span class="op">(</span></span>
<span>  sTYPE   <span class="op">=</span> <span class="st">"subject"</span>,</span>
<span>  sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_size_2.sqlite"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dfResult2_s</span><span class="op">$</span><span class="va">nNum_scr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1244.25</span></span></code></pre></div>
<p>必要な調査対象者数の平均は約1244人となりました。</p>
<p>スロット割付方法を(adaptive,all,shortnum,allclosed)としたときの調査対象者数の平均は約520人でしたから、
こちらの割付方法のほうがはるかに多くの調査対象者を必要とすることがわかります。</p>
</div>
<div class="section level2">
<h2 id="まとめ-標本サイズ推定のための関数">6. まとめ: 標本サイズ推定のための関数<a class="anchor" aria-label="anchor" href="#%E3%81%BE%E3%81%A8%E3%82%81-%E6%A8%99%E6%9C%AC%E3%82%B5%E3%82%A4%E3%82%BA%E6%8E%A8%E5%AE%9A%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E9%96%A2%E6%95%B0"></a>
</h2>
<p><code>rSurveyAssign</code>パッケージが提供する関数のうち、標本サイズ推定に関連する関数は以下の通りです。</p>
<ul>
<li>
<code>makePop</code>: 母集団データを作成する</li>
<li>
<code>makeSetting</code>: 割付のセッティングを作成する</li>
<li>
<code>simSize</code>:
シミュレーションを実行し結果をデータベースに格納する</li>
<li>
<code>getSize</code>:
データベースに格納されたシミュレーション結果を集計して取り出す</li>
<li>
<code>getSize_raw</code>:
データベースに格納されたシミュレーション結果(ローデータ)を取り出す</li>
<li>
<code>countSize</code>:
データベースに格納されたシミュレーション結果の試行数を調べる</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://elsur.jpn.org/" class="external-link">Shigeru ONO</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
