<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rSurveyAssign">
<title>3. How to estimate bias • rSurveyAssign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3. How to estimate bias">
<meta property="og:description" content="rSurveyAssign">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rSurveyAssign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/vignette.html">Get Started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette_assign.html">1. How to assign subjects</a>
    <a class="dropdown-item" href="../articles/vignette_size.html">2. How to forecast sample size</a>
    <a class="dropdown-item" href="../articles/vignette_bias.html">3. How to estimate bias</a>
    <a class="dropdown-item" href="../articles/vignette_weight.html">4. How to compute survey weights</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>3. How to estimate bias</h1>
                        <h4 data-toc-skip class="author">Shigeru
ONO</h4>
            
            <h4 data-toc-skip class="date">2024-05-22</h4>
      
      
      <div class="d-none name"><code>vignette_bias.Rmd</code></div>
    </div>

    
    
<p>ここでは、<code>rSurveyAssign</code>パッケージを使った割付バイアスの評価について
説明します。</p>
<p><code>rSurveyAssign</code>パッケージの背後にある考え方については、 <a href="vignette.html">“rSurveyAssign: tools for simulation of assignment
in web surveys”</a>を参照して下さい。</p>
<p>調査手続きを設計している際には、これから行う調査における割付バイアスの大きさについて、ある程度の
目安をつけたくなります。しかし、割付バイアスの強さをかんたんに知ることはできません。
そこで<code>rSurveyAssign</code>パッケージは、割付バイアスの強さを評価する機能を提供しています。</p>
<div class="section level2">
<h2 id="割付バイアスの定義と性質">1. 割付バイアスの定義と性質<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%A8%E6%80%A7%E8%B3%AA"></a>
</h2>
<div class="section level3">
<h3 id="割付バイアスの定義">1.1 割付バイアスの定義<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%81%AE%E5%AE%9A%E7%BE%A9"></a>
</h3>
<p>割付バイアスとは、ひとことでいえば、割付に起因するバイアスのことです。以下では議論を進めやすくするために、
割付バイアスについてもっと明確に定義しておきましょう。</p>
<p>あるカテゴリないしスロットAについて考えます。ある調査を行ったとき、調査対象者(調査に参加した人)のなかにAに割付可能であった対象者が<span class="math inline">\(N\)</span>人いたとします。仮に、その人々すべてからAについての設問への回答を得たとしましょう。
そのとき対象者<span class="math inline">\(i(=1,\ldots,
N)\)</span>の回答から得られる関心ある値を<span class="math inline">\(x_i\)</span>とし、その平均を<span class="math display">\[\bar{x}_P = \frac{1}{N} \sum_{i=1}^N x_i\]</span>
とします。添字<span class="math inline">\(P\)</span>は割付可能な調査対象者を表しています。</p>
<p>以下では、私たちの目的は<span class="math inline">\(\bar{x}_P\)</span>を推測することだと考えます。通常の調査では、推測したいのは<span class="math inline">\(\bar{x}_P\)</span>ではなく、その背後にある対象母集団における回答の平均や、回答誤差をも取り除いた真の態度・意見の平均だと考えるのが普通です。しかし、ここではある調査のなかでの割付バイアスについて議論しているので、推測の対象は<span class="math inline">\(\bar{x}_P\)</span>だと考えることにします。</p>
<p>さて、調査コストや回答負荷を低減するため、Aに割付可能であった<span class="math inline">\(N\)</span>人の対象者すべてからAについての回答を得るのではなく、そのなかの<span class="math inline">\(n\)</span>人をAに割りつけ、この人たちのみからAについての回答を得たとします。対象者<span class="math inline">\(i\)</span>がAに割り付けられたとき1,
割り付けられなかったとき0になる変数を<span class="math inline">\(I_i\)</span>とします。</p>
<p>Aに割り付けられた<span class="math inline">\(n\)</span>人の対象者から得られる<span class="math inline">\(x_i\)</span>の平均は、以下のように表現できます。添字<span class="math inline">\(S\)</span>は割り付けられた調査対象者を表しています。
<span class="math display">\[ \bar{x}_S = \frac{1}{n} \sum_{i=1}^N I_i
x_i \]</span></p>
<p>以下では<strong>割付バイアス</strong>を、割り付けられた対象者における関心ある変数の平均の期待値と、割付可能なすべての対象者における関心ある変数の平均とのずれ
<span class="math inline">\(E[\bar{x}_S] - \bar{x}_P\)</span>
であると定義します。</p>
</div>
<div class="section level3">
<h3 id="割付バイアスの性質">1.2 割付バイアスの性質<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%81%AE%E6%80%A7%E8%B3%AA"></a>
</h3>
<p>割付バイアスはどのような性質を持つでしょうか。</p>
<p>以下では、対象者の回答<span class="math inline">\(x_i\)</span>は定数であり、Aへの割付の有無<span class="math inline">\(I_i\)</span>は確率変数であると考えます。また、便宜的に、割り付けられた調査対象者数<span class="math inline">\(n\)</span>、割付可能な調査対象者数<span class="math inline">\(N\)</span>はともに定数であるとみなします。</p>
<p>対象者<span class="math inline">\(i\)</span>がAに割り付けられる確率を<span class="math inline">\(p_i = E[I_i]\)</span>とし、<span class="math inline">\(q_i = \frac{N}{n} p_i\)</span>とすると、
割付バイアスは以下のように表現できます。</p>
<p><span class="math display">\[E[\bar{x}_S] - \bar{x}_P = \frac{1}{N}
\sum_{i=1}^N (q_i - \bar{q}_P)(x_i - \bar{x}_P)\]</span>
つまり、割付バイアスとは、「割付確率を割付可能対象者を通じて平均が1になるようにスケーリングした値」と、関心ある変数との、割付可能対象者を通じた共分散です。いいかえれば、割付バイアスは、関心ある変数<span class="math inline">\(x_i\)</span>と割付確率<span class="math inline">\(p_i\)</span>の間に関連があるときに生じるバイアスです。</p>
</div>
<div class="section level3">
<h3 id="割付確率の推定">1.3 割付確率の推定<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E7%A2%BA%E7%8E%87%E3%81%AE%E6%8E%A8%E5%AE%9A"></a>
</h3>
<p>あるカテゴリ・スロットへの回答における割付バイアスの大きさについて推測するためには、
そのカテゴリ・スロットに割付可能であった対象者について割付確率<span class="math inline">\(p_i\)</span>を推測する必要があります。</p>
<p>このパッケージでは、仮想的な母集団を用いたシミュレーションを通じて割付確率を推定します。
このシミュレーションは以下の手順に従います。</p>
<ul>
<li>母集団データから対象者を抽出し、カテゴリ・スロットへの割付を行う(<strong>割付試行</strong>)。</li>
<li>ある割付試行で得た調査データから無作為復元抽出によって仮想的な調査データを再生成し、カテゴリ・スロットへの割付をやりなおす(<strong>再割付試行</strong>)。</li>
<li>再割付試行を繰り返し、各カテゴリ・スロットについて、それに割付可能である個々の対象者<span class="math inline">\(i\)</span>の割付確率の推定値<span class="math inline">\(\hat{p}_i\)</span>、ならびに推定量の分散の推定値<span class="math inline">\(\hat{V}_i\)</span>を得る。 <a href="vignette_weight.html">“How to compute survey
weights”</a>を参照して下さい。</li>
<li>以上の割付試行を複数回繰り返す。</li>
</ul>
</div>
<div class="section level3">
<h3 id="割付バイアスを評価するための指標">1.4 割付バイアスを評価するための指標<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E6%8C%87%E6%A8%99"></a>
</h3>
<p><code>rSurveyAssign</code>パッケージは、 推定された<span class="math inline">\(p_i\)</span>, <span class="math inline">\(V_i\)</span>に基づいて、これから行う調査が持つであろう割付バイアスを評価します。
本項では、評価の際に用いる指標について説明します。</p>
<div class="section level4">
<h4 id="割付確率の変動係数の推定値hatmathrmcvp">
<strong>割付確率の変動係数の推定値</strong><span class="math inline">\(\hat{\mathrm{CV}}(p)\)</span><a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E7%A2%BA%E7%8E%87%E3%81%AE%E5%A4%89%E5%8B%95%E4%BF%82%E6%95%B0%E3%81%AE%E6%8E%A8%E5%AE%9A%E5%80%A4hatmathrmcvp"></a>
</h4>
<p>あるカテゴリないしスロットにおいて生じる割付バイアスとは、割付可能対象者を通じた「平均が1になるようにスケーリングした割付確率」<span class="math inline">\(q_i = p_i /
\bar{p}_P\)</span>と、関心ある変数<span class="math inline">\(x_i\)</span>との共分散です。関心ある変数を特定しないと、割付バイアスの大きさもわからないわけです。</p>
<p>しかし、<span class="math inline">\(q_i\)</span>のばらつきが小さければ、いかなる変数においても割付バイアスは小さいといえます。関心ある変数を特定できない状況では、<span class="math inline">\(q_i\)</span>の標準偏差を割付バイアスの大きさの目安として捉えることができます。</p>
<p>そこでこのパッケージでは、<strong>割付確率の変動係数の推定値</strong><span class="math inline">\(\hat{\mathrm{CV}}(p)\)</span>を、割付バイアスの大きさの指標のひとつとして提供します。</p>
<p><code>rSurveyAssign</code>パッケージはこの値を以下のように求めています。割付可能対象者<span class="math inline">\(i(=1,...,N)\)</span>の割付確率の推定値を<span class="math inline">\(\hat{p}_i\)</span>とします。 <span class="math display">\[ \bar{\hat{p}}_P = \frac{1}{N} \sum_{i=1}^N
\hat{p}_i \]</span> <span class="math display">\[ \mathrm{CV}(\hat{p}) =
\frac{1}{\bar{\hat{p}}_P} \times \sqrt{ \frac{1}{N} \sum_{i=1}^N
(\hat{p}_i - \bar{\hat{p}}_P)^2 } \]</span> <span class="math display">\[ \hat{\mathrm{CV}}(p) = \sqrt{
(\mathrm{CV}(\hat{p}))^2 - \frac{\frac{1}{N} \sum_{i=1}^N
\hat{V}_i}{\bar{\hat{p}}_P^2}} \]</span></p>
</div>
<div class="section level4">
<h4 id="そのほかの指標">そのほかの指標<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E3%81%BB%E3%81%8B%E3%81%AE%E6%8C%87%E6%A8%99"></a>
</h4>
<p>なお、その他の指標として以下も出力されます。</p>
<ul>
<li>割付確率の推定値の変動係数 <span class="math inline">\(\mathrm{CV}(\hat{p})\)</span>。上記を参照。</li>
<li>デザイン効果の推定値 <span class="math inline">\(\hat{\mathrm{Deff}}\)</span>
</li>
<li>実質標本サイズの推定値 <span class="math inline">\(\hat{\mathrm{ESS}}\)</span>
</li>
<li>スケーリングした割付確率の推定値と割付可能レシオ(全カテゴリないしスロットに占める割付可能カテゴリないしスロットの割合)との共分散の推定値
<span class="math inline">\(\mathrm{Cov}(\hat{q}, r)\)</span>
</li>
<li>割付可能対象者における割付可能レシオの平均</li>
<li>割り付けられた対象者における割付可能レシオの平均</li>
</ul>
<p><span class="math inline">\(\hat{\mathrm{Deff}},  \hat{\mathrm{ESS}}\)</span>の定義は以下の通りです。</p>
<p><span class="math display">\[ \hat{w}_i = 1 / \hat{p}_i\]</span>
<span class="math display">\[ \bar{\hat{w}}_S = \frac{1}{n} \sum_{i=1}^n
\hat{w}_i\]</span> <span class="math display">\[ \hat{\mathrm{Deff}} = 1
+ \left( \frac{1}{\bar{\hat{w}}_S^2} \times \frac{1}{n} \sum_{i=1}^n
(\hat{w}_i - \bar{\hat{w}}_S)^2 \right) \]</span> <span class="math display">\[ \hat{\mathrm{ESS}} =
\frac{n}{\hat{\mathrm{Deff}}}\]</span></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="データの準備">2. データの準備<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99"></a>
</h2>
<p>では、<code>rSurveyAssign</code>パッケージによるバイアス評価の手順について説明しましょう。</p>
<p>母集団を表現するデータを用意し、popdataクラスのオブジェクトに変換します。
<a href="vignette_size.html">“How to forecast sample
size”</a>を参照して下さい。</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shigono.github.io/rSurveyAssign/">rSurveyAssign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 母集団オブジェクトの作成</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">popdata</span>, package <span class="op">=</span> <span class="st">"rSurveyAssign"</span><span class="op">)</span></span>
<span><span class="va">mbCat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bCat_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lSlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_1_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_2_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">popdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bSlot_3_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">lPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makePop.html">makePop</a></span><span class="op">(</span>mbCAT <span class="op">=</span> <span class="va">mbCat</span>, lSLOT <span class="op">=</span> <span class="va">lSlot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [makePop] assign colnames to lSLOT ...</span></span>
<span><span class="co">#&gt; [makePop] # of categories: 3 </span></span>
<span><span class="co">#&gt; [makePop] # of slots: 10,10,10 </span></span>
<span><span class="co">#&gt; [makePop] # of members: 10000 </span></span>
<span><span class="co">#&gt; [makePop] # of member-category pairs which are assignable: 26488 (8829.3/category) </span></span>
<span><span class="co">#&gt; [makePop] # of member-slot pairs which are assignable: 58836 (1961.2/slot)</span></span></code></pre></div>
<p>割付のセッティングを指定します。</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 割付のセッティング</span></span>
<span><span class="va">lSetting1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeSetting.html">makeSetting</a></span><span class="op">(</span></span>
<span>  lSLOT_REQUEST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lSlot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  nCAT_MAX      <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  sCAT_ASSIGN   <span class="op">=</span> <span class="st">'assignable-shortnum-open-none'</span>,  <span class="co"># (ver 0.3までの指定方法ではadaptive,open,shortnum,allclosed)</span></span>
<span>  nSLOT_MAX     <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  sSLOT_ASSIGN  <span class="op">=</span> <span class="st">'assignable-shortnum-open-none'</span>   <span class="co"># (ver 0.3までの指定方法ではadaptive,open,shortnum,allclosed)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [makeSetting] assign names to lSLOT_REQUEST ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="割付再割付シミュレーション">3. 割付・再割付シミュレーション<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E5%86%8D%E5%89%B2%E4%BB%98%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"></a>
</h2>
<p>割付確率を推定するためのシミュレーションを行います。</p>
<p>バイアスを評価するためには、十分な数の再割付試行を繰り返す必要があります。
そこで、割付試行を10試行、再割付試行を割付試行あたり1000試行繰り返してみましょう。</p>
<p>シミュレーションの結果はサイズが大きいので、SQLiteデータベース上に
保存したほうがよいでしょう。
以下の例では、SQLiteデータベースファイルとして<code>../tools/rSurveyAssign_vignette_bias_1.sqlite</code>を
作成しています。実際には、適切なフォルダとファイル名を指定してください。また、
データベースファイルは、必要がなくなったら自分で消してください。</p>
<p>実行時間を短くするため、並列処理を行うことにします。引数<code>bPARALLEL</code>にTRUEを指定します。
並列処理を行う場合、各試行についてのメッセージは画面に表示されません。
そこでログファイルを作成することにします。
実行に長い時間がかかる場合は、ログファイルを監視すると、
いま何試行まで進んでいるかわかり、少しだけ心が癒されるでしょう。</p>
<p>下の例では、ログファイルを<code>C:/work/simBias.log</code>としています。
RStudioを使っているなら、Terminalウィンドウで<code>tail -F C:/work/simBias.log</code>を
実行すると、ログファイルを監視できます。</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 都合によりコメントアウトしています</span></span>
<span><span class="co"># set.seed(123)  # 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="co"># simBias (</span></span>
<span><span class="co">#   lPOP        = lPop, </span></span>
<span><span class="co">#   lSETTING    = lSetting1, </span></span>
<span><span class="co">#   sDBPATH     = "../tools/rSurveyAssign_vignette_bias_1.sqlite",</span></span>
<span><span class="co">#   nNUMTRIAL   = 10,</span></span>
<span><span class="co">#   nNUMRETRIAL = 1000,</span></span>
<span><span class="co">#   bAPPEND     = FALSE, </span></span>
<span><span class="co">#   bPARALLEL   = TRUE,</span></span>
<span><span class="co">#   sLOGFILE    = "c:/work/simBias.log"</span></span>
<span><span class="co"># )</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="割付バイアスの評価">4. 割付バイアスの評価<a class="anchor" aria-label="anchor" href="#%E5%89%B2%E4%BB%98%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E3%81%AE%E8%A9%95%E4%BE%A1"></a>
</h2>
<p>では、割付バイアスを評価してみましょう。関数<code>getBias</code>を使います。</p>
<div class="section level3">
<h3 id="カテゴリごとのバイアス">4.1 カテゴリごとのバイアス<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AE%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9"></a>
</h3>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>cat</code>とすると、
各試行での各カテゴリごとの割付バイアスを評価することができます。
<code>getBias</code>の返し値はデータフレームです。内容をみてみましょう。</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult1_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"cat"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_1.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfResult1_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#&gt;   nTrial  nCat nNumAssignable nNumAssign gCVHatP gHatCVP gHatDeff gHatESS</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1     1           <span style="text-decoration: underline;">5</span>578       <span style="text-decoration: underline;">2</span>210   0.339   0.336     1.06   <span style="text-decoration: underline;">2</span>084.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1     2           <span style="text-decoration: underline;">5</span>513       <span style="text-decoration: underline;">1</span>995   0.150   0.144     1.02   <span style="text-decoration: underline;">1</span>965.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1     3           <span style="text-decoration: underline;">4</span>759       <span style="text-decoration: underline;">1</span>478   0.127   0.117     1.01   <span style="text-decoration: underline;">1</span>465.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      2     1           <span style="text-decoration: underline;">5</span>386       <span style="text-decoration: underline;">1</span>966   0.363   0.360     1.07   <span style="text-decoration: underline;">1</span>833.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      2     2           <span style="text-decoration: underline;">5</span>300       <span style="text-decoration: underline;">2</span>020   0.152   0.146     1.02   <span style="text-decoration: underline;">1</span>990.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      2     3           <span style="text-decoration: underline;">4</span>608       <span style="text-decoration: underline;">1</span>527   0.157   0.149     1.01   <span style="text-decoration: underline;">1</span>508.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: gCovHatQR &lt;dbl&gt;, gBarR_P &lt;dbl&gt;, gBarR_S &lt;dbl&gt;</span></span></span></code></pre></div>
<p>行は各割付試行における各カテゴリを表しています。
各列は以下を表しています。</p>
<ul>
<li>
<code>nNumAssignable</code>:
割付可能であった対象者数。試行1ではカテゴリ1に割付可能な対象者が5578人いました。</li>
<li>
<code>nNumAssign</code>:
割り付けられた対象者数。試行1ではカテゴリ1に2210人が割り付けられました。</li>
<li>
<code>gHatCVP</code>: 割付確率の変動係数の推定値<span class="math inline">\(\hat{\mathrm{CV}}(p)\)</span>。この値が大きいほど、割付バイアスが大きくなる見込みが高いと考えられます。</li>
</ul>
</div>
<div class="section level3">
<h3 id="スロットごとのバイアス">4.2 スロットごとのバイアス<a class="anchor" aria-label="anchor" href="#%E3%82%B9%E3%83%AD%E3%83%83%E3%83%88%E3%81%94%E3%81%A8%E3%81%AE%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9"></a>
</h3>
<p>関数<code>getSize</code>の引数<code>sTYPE</code>を<code>slot</code>とすると、
各試行での各スロットごとの割付バイアスを評価することができます。
<code>getBias</code>の返し値はデータフレームです。内容をみてみましょう。</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult1_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"slot"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_1.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfResult1_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#&gt;   nTrial nParentCat nSlot nNumAssignable nNumAssign gCVHatP gHatCVP gHatDeff</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1          1     1           <span style="text-decoration: underline;">1</span>775        100   1.37    1.36    <span style="color: #BB0000;">NaN</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1          1     2            855        100   0.566   0.558     1.62</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1          1     3           <span style="text-decoration: underline;">1</span>217        100   0.811   0.803     1.41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      1          1     4           <span style="text-decoration: underline;">1</span>316        100   0.874   0.866    26.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      1          1     5            283        100   0.165   0.158     1.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      1          1     6           <span style="text-decoration: underline;">1</span>248        100   0.814   0.805     2.16</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: gHatESS &lt;dbl&gt;, gCovHatQR &lt;dbl&gt;, gBarR_P &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   gBarR_S &lt;dbl&gt;</span></span></span></code></pre></div>
<p>行は各割付試行における各カテゴリの各スロットを表しています。各変数の意味はカテゴリの場合と同様です。</p>
</div>
</div>
<div class="section level2">
<h2 id="分析例-割付方法の間の比較">5. 分析例: 割付方法の間の比較<a class="anchor" aria-label="anchor" href="#%E5%88%86%E6%9E%90%E4%BE%8B-%E5%89%B2%E4%BB%98%E6%96%B9%E6%B3%95%E3%81%AE%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83"></a>
</h2>
<p>こんどは、別の割付方法を試してみます。</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 割付のセッティング</span></span>
<span><span class="va">lSetting2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeSetting.html">makeSetting</a></span><span class="op">(</span></span>
<span>  lSLOT_REQUEST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lSlot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mbSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  nCAT_MAX      <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  sCAT_ASSIGN   <span class="op">=</span> <span class="st">'all-shortnum-open-none'</span>,  <span class="co"># (ver 0.3までの指定方法ではnonadaptive,open,shortnum,none)</span></span>
<span>  nSLOT_MAX     <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  sSLOT_ASSIGN  <span class="op">=</span> <span class="st">'all-shortnum-open-none'</span>   <span class="co"># (ver 0.3までの指定方法ではnonadaptive,open,shortnum,none)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [makeSetting] assign names to lSLOT_REQUEST ...</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 都合によりコメントアウトしています</span></span>
<span><span class="co"># set.seed(123)  # 結果を再現するために乱数のシードを設定している。通常は設定不要</span></span>
<span><span class="co"># simBias (</span></span>
<span><span class="co">#   lPOP       = lPop, </span></span>
<span><span class="co">#   lSETTING   = lSetting2, </span></span>
<span><span class="co">#   sDBPATH    = "../tools/rSurveyAssign_vignette_bias_2.sqlite",</span></span>
<span><span class="co">#   nNUMTRIAL  = 10,</span></span>
<span><span class="co">#   nNUMRETRIAL = 500,</span></span>
<span><span class="co">#   bAPPEND    = FALSE, </span></span>
<span><span class="co">#   bPARALLEL  = TRUE,</span></span>
<span><span class="co">#   sLOGFILE   = "c:/work/simWeight.log"</span></span>
<span><span class="co"># )</span></span></code></pre></div>
<p>スロットについての割付バイアスを調べてみましょう。</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfResult2_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBias.html">getBias</a></span><span class="op">(</span>sTYPE <span class="op">=</span> <span class="st">"slot"</span>, sDBPATH <span class="op">=</span> <span class="st">"../tools/rSurveyAssign_vignette_bias_2.sqlite"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfResult2_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#&gt;   nTrial nParentCat nSlot nNumAssignable nNumAssign gCVHatP gHatCVP gHatDeff</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1          1     1           <span style="text-decoration: underline;">3</span>496        100   0.288  0.026<span style="text-decoration: underline;">8</span>     1.13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1          1     2           <span style="text-decoration: underline;">1</span>654        100   0.198  0.038<span style="text-decoration: underline;">9</span>     1.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1          1     3           <span style="text-decoration: underline;">2</span>363        100   0.231  0          1.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      1          1     4           <span style="text-decoration: underline;">2</span>516        100   0.243  0.026<span style="text-decoration: underline;">4</span>     1.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      1          1     5            565        100   0.104  0          1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      1          1     6           <span style="text-decoration: underline;">2</span>352        100   0.239  0.052<span style="text-decoration: underline;">4</span>     1.08</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: gHatESS &lt;dbl&gt;, gCovHatQR &lt;dbl&gt;, gBarR_P &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   gBarR_S &lt;dbl&gt;</span></span></span></code></pre></div>
<p>どうやら、この割付方法では割付バイアスがきわめて小さいようです。先ほどの割付方法と
比べてみましょう。</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dfPlot</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">dfResult1_s</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nMethod <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">dfResult2_s</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nMethod <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">nMethod</span>, <span class="va">nParentCat</span>, <span class="va">nSlot</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>gMeanCovHatQR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gCovHatQR</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'nMethod', 'nParentCat'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dfX</span> <span class="op">&lt;-</span> <span class="va">dfPlot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">nParentCat</span>, <span class="va">nSlot</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">nParentCat</span>, <span class="va">nSlot</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nX <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">nX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nX</span>, levels <span class="op">=</span> <span class="va">nX</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Cat"</span>, <span class="va">nParentCat</span>, <span class="st">"_Slot"</span>, <span class="va">nSlot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfPlot</span> <span class="op">&lt;-</span> <span class="va">dfPlot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dfX</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nParentCat"</span>, <span class="st">"nSlot"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fMethod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nMethod</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"方法1"</span>, <span class="st">"方法2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dfPlot</span>, </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fX</span>, y <span class="op">=</span> <span class="va">gMeanCovHatQR</span>, group <span class="op">=</span> <span class="va">fMethod</span>, color <span class="op">=</span> <span class="va">fMethod</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"スロット"</span>, y <span class="op">=</span> <span class="st">"割付バイアスの強さ (Cov(hat{q},r)の平均)"</span>, color <span class="op">=</span> <span class="st">"割付方法"</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_bias_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<p>さきほどの割付方法と異なり、指標の値がほぼ0になっています。</p>
<p>なお、この割付方法をよく見ると、割付カテゴリの最大数が1であり、カテゴリ割付とスロット割付の両方で(<code>nonadaptive</code>,
<code>open</code>, <code>shortnum</code>,
<code>none</code>)を用いています。この割付方法は、
割付バイアスを生まない数少ない割付方法のうちのひとつです。
上の結果はそのことをシミュレーションによって裏付けています。</p>
</div>
<div class="section level2">
<h2 id="まとめ-割付バイアス評価に関連する関数">6. まとめ: 割付バイアス評価に関連する関数<a class="anchor" aria-label="anchor" href="#%E3%81%BE%E3%81%A8%E3%82%81-%E5%89%B2%E4%BB%98%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9%E8%A9%95%E4%BE%A1%E3%81%AB%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B%E9%96%A2%E6%95%B0"></a>
</h2>
<p><code>rSurveyAssign</code>パッケージが提供する関数のうち、割付バイアスの評価に関連する関数は以下の通りです。</p>
<ul>
<li>
<code>makePop</code>: 母集団データを作成する</li>
<li>
<code>makeSetting</code>: 割付のセッティングを作成する</li>
<li>
<code>simBias</code>:
シミュレーションを実行し結果をデータベースに格納する</li>
<li>
<code>getBias</code>:
データベースに格納されたシミュレーション結果を集計して取り出す</li>
<li>
<code>countBias</code>:
データベースに格納されたシミュレーション結果の試行数を調べる</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://elsur.jpn.org/" class="external-link">Shigeru ONO</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
